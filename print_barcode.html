<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>طباعة الباركود — الصقري للاتصالات</title>

  <!-- نفس الخط/المكتبات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; }
    .card { box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
    .barcode-wrap { display:flex; justify-content:center; }
    .hint { font-size: .9rem; }

    @media print {
      .btn, .card-title, .form-text, .hint, .form-control, .input-group, .print-controls, .back-link { display: none !important; }
      .card { border: none; box-shadow: none; }
      .card-body { padding: 0; }
      img, svg { max-width: 100%; height: auto; }
      .container { margin-top: 0 !important; }
    }
  </style>
</head>
<body>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6 text-center">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title mb-4">باركود الهاتف</h4>

          <!-- واجهة فقط: حقل لإدخال رقم الهاتف وتوليد شكل باركود بسيط -->
          <div class="print-controls mb-3">
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
              <input id="phone_number" type="text" class="form-control" placeholder="أدخل رقم الهاتف (واجهة فقط)">
              <button class="btn btn-outline-primary" type="button" onclick="renderFakeBarcode()">تحديث الباركود</button>
            </div>
            <div class="form-text text-muted text-start mt-1">هذه واجهة فقط — اربط التوليد بمصدر الباركود لاحقاً.</div>
          </div>

          <div class="mb-4 barcode-wrap">
            <!-- بدل: <img src="{{ url_for('get_barcode', phone_number=phone.phone_number) }}" ...> -->
            <!-- نعرض SVG بسيط يحاكي شكل الباركود كواجهة فقط -->
            <div id="barcode_box" class="border rounded p-2">
              <svg id="barcode_svg" xmlns="http://www.w3.org/2000/svg" width="360" height="120" viewBox="0 0 360 120" role="img" aria-label="Barcode">
                <rect width="360" height="120" fill="#fff"/>
                <!-- أعمدة أولية (تُحدّث عبر JS) -->
                <g id="bars"></g>
                <text id="barcode_text" x="50%" y="108" text-anchor="middle" font-family="monospace" font-size="16">0000000000</text>
              </svg>
            </div>
          </div>

          <div class="mb-4 text-start">
            <h5 class="mb-3 text-center">معلومات الهاتف</h5>

            <!-- في الأصل كان هناك منطق لحالة الهاتف (مستعمل/جديد). هنا واجهة فقط تُظهر تنبيهًا إن كان "used" ومعه age -->
            <div id="battery_note" class="alert alert-info d-none">
              <i class="fas fa-info-circle"></i>
              <strong>ملاحظة:</strong> عمر البطارية (<span id="age_text">0</span> شهر) مشفّر ضمن الباركود
            </div>

            <p class="mb-1"><strong>الشركة المصنعة:</strong> <span id="brand">—</span></p>
            <p class="mb-1"><strong>الموديل:</strong> <span id="model">—</span></p>
            <p class="mb-1"><strong>رقم الهاتف:</strong> <span id="phone_num_disp">—</span></p>
            <p class="mb-1"><strong>الرقم التسلسلي:</strong> <span id="serial_number">—</span></p>

            <!-- حقول واجهة لتعبئة البيانات محليًا -->
            <div class="row g-2 mt-3 print-controls">
              <div class="col-6">
                <input id="brand_in" class="form-control form-control-sm" placeholder="الشركة المصنعة" oninput="syncInfo()">
              </div>
              <div class="col-6">
                <input id="model_in" class="form-control form-control-sm" placeholder="الموديل" oninput="syncInfo()">
              </div>
              <div class="col-6">
                <input id="serial_in" class="form-control form-control-sm" placeholder="الرقم التسلسلي" oninput="syncInfo()">
              </div>
              <div class="col-6">
                <select id="condition_in" class="form-select form-select-sm" onchange="syncInfo()">
                  <option value="new">جديد</option>
                  <option value="used">مستعمل</option>
                </select>
              </div>
              <div class="col-6">
                <input id="age_in" type="number" min="0" class="form-control form-control-sm" placeholder="عمر البطارية بالأشهر" oninput="syncInfo()">
              </div>
            </div>

            <div class="hint text-muted mt-2">يمكنك لاحقًا تعبئة هذه البيانات تلقائيًا من API قبل الطباعة.</div>
          </div>

          <div class="d-grid gap-2">
            <button onclick="window.print()" class="btn btn-primary">طباعة الباركود</button>
            <a href="dashboard.html" class="btn btn-secondary back-link">العودة للوحة التحكم</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // واجهة فقط: رسم أعمدة "تشبه" الباركود (ليست ترميزًا حقيقيًا)
  function renderFakeBarcode() {
    const barsG = document.getElementById('bars');
    const txt = document.getElementById('barcode_text');
    const pn = (document.getElementById('phone_number').value || '0000000000').replace(/\D/g,'').slice(0,12);
    txt.textContent = pn || '0000000000';
    document.getElementById('phone_num_disp').textContent = pn || '—';

    // مسح الأعمدة القديمة
    barsG.innerHTML = '';

    // أنماط أعمدة بسيطة مشتقة من الأرقام (واجهة فقط)
    const w = 360, h = 100, startX = 10, endX = w - 10;
    let x = startX;
    const digits = (pn || '000000000000').padEnd(12,'0').split('').map(d=>parseInt(d,10));

    // لكل رقم ارسم 2-3 أعمدة بُنى مختلفة
    digits.forEach((d, idx) => {
      const count = 2 + (d % 2);       // 2 أو 3 أعمدة
      for (let i=0; i<count; i++) {
        const barW = 1 + (d % 3);      // سمك 1-3 بكسل
        const gap  = 1 + ((d+i) % 2);  // فجوة 1-2
        if (x + barW > endX) break;
        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', 8);
        rect.setAttribute('width', barW);
        rect.setAttribute('height', h - 24);
        rect.setAttribute('fill', '#000');
        barsG.appendChild(rect);
        x += barW + gap;
      }
    });

    // حواجز جانبية بسيطة
    function guard(atX){
      [['rect', {x:atX, y:8, width:2, height:h-24}],
       ['rect', {x:atX+4, y:8, width:2, height:h-24}]].forEach(([tag,attrs])=>{
        const r = document.createElementNS('http://www.w3.org/2000/svg', tag);
        Object.entries(attrs).forEach(([k,v])=>r.setAttribute(k,v));
        r.setAttribute('fill','#000'); barsG.appendChild(r);
      });
    }
    guard(10); guard( w-14 );
  }

  function syncInfo(){
    document.getElementById('brand').textContent  = document.getElementById('brand_in').value || '—';
    document.getElementById('model').textContent  = document.getElementById('model_in').value || '—';
    document.getElementById('serial_number').textContent = document.getElementById('serial_in').value || '—';

    const cond = document.getElementById('condition_in').value || 'new';
    const ageV = parseInt(document.getElementById('age_in').value)||0;

    const note = document.getElementById('battery_note');
    const ageT = document.getElementById('age_text');
    if (cond === 'used' && ageV > 0){
      ageT.textContent = ageV;
      note.classList.remove('d-none');
    } else {
      note.classList.add('d-none');
    }
  }

  // تهيئة أولية
  document.addEventListener('DOMContentLoaded', () => {
    renderFakeBarcode();
    syncInfo();
  });
</script>
</body>
</html>
