<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إضافة أنواع الآيفون الشائعة — الصقري للاتصالات</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; padding-top: 70px; }
    .navbar { background-color: #2c3e50; position: fixed; top: 0; width: 100%; z-index: 1030; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .navbar-brand, .nav-link { color: white !important; }
    .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn-primary { background-color: #2c3e50; border-color: #2c3e50; }
    .btn-primary:hover { background-color: #1a252f; border-color: #1a252f; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <span class="navbar-brand">الصقري للاتصالات</span>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="dashboard.html"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
          <li class="nav-item"><a class="nav-link" href="search.html"><i class="fas fa-search"></i> البحث</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header bg-primary text-white d-flex align-items-center justify-content-between">
            <h5 class="mb-0"><i class="fas fa-mobile-alt"></i> إضافة أنواع الآيفون الشائعة (iPhone X → iPhone 17)</h5>
          </div>
          <div class="card-body">
            <p class="text-muted">ينشئ هذه الصفحة الأنواع ضمن مجموعة phone_types في قاعدة البيانات بدون تكرار.</p>

            <div class="d-grid gap-2">
              <button id="seedBtn" class="btn btn-success btn-lg" onclick="seedIphoneTypes()">
                <i class="fas fa-plus-circle"></i>
                إضافة الأنواع الآن
              </button>
            </div>

            <div class="mt-3" id="result_box" style="display:none;">
              <div class="alert" id="result_alert"></div>
              <div id="details" class="small text-muted"></div>
            </div>

            <div class="mt-3">
              <a href="add_new_phone.html" class="btn btn-outline-primary"><i class="fas fa-mobile"></i> إضافة هاتف جديد</a>
              <a href="add_used_phone.html" class="btn btn-outline-secondary"><i class="fas fa-mobile-alt"></i> إضافة هاتف مستعمل</a>
              <a href="dashboard.html" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> العودة للوحة التحكم</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="js/firebase-config.js"></script>
  <script type="module" src="js/firebase-database.js"></script>
  <script type="module" src="js/firebase-storage-manager.js"></script>

  <script>
    function showResult(type, msg, extra = '') {
      const box = document.getElementById('result_box');
      const alert = document.getElementById('result_alert');
      const details = document.getElementById('details');
      box.style.display = 'block';
      alert.className = `alert alert-${type}`;
      alert.textContent = msg;
      details.innerHTML = extra;
    }

    async function seedIphoneTypes() {
      const btn = document.getElementById('seedBtn');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإضافة...';

      try {
        if (!window.storage) {
          showResult('danger', '⚠️ لم يتم تهيئة التخزين');
          btn.disabled = false; btn.textContent = 'إضافة الأنواع الآن';
          return;
        }

        const iphoneModels = [
          'iPhone X', 'iPhone XR', 'iPhone XS', 'iPhone XS Max',
          'iPhone 11', 'iPhone 11 Pro', 'iPhone 11 Pro Max',
          'iPhone SE (2nd)', 'iPhone SE (3rd)',
          'iPhone 12', 'iPhone 12 Mini', 'iPhone 12 Pro', 'iPhone 12 Pro Max',
          'iPhone 13', 'iPhone 13 Mini', 'iPhone 13 Pro', 'iPhone 13 Pro Max',
          'iPhone 14', 'iPhone 14 Plus', 'iPhone 14 Pro', 'iPhone 14 Pro Max',
          'iPhone 15', 'iPhone 15 Plus', 'iPhone 15 Pro', 'iPhone 15 Pro Max',
          'iPhone 16', 'iPhone 16 Plus', 'iPhone 16 Pro', 'iPhone 16 Pro Max',
          'iPhone 17', 'iPhone 17 Pro', 'iPhone 17 Pro Max'
        ];

        // قراءة الموجود لتجنب التكرار (المخرجات كائن {brand: [models]})
        let existing = {};
        try {
          existing = await window.storage.getPhoneTypes();
        } catch (e) { existing = {}; }
        const existingModels = new Set((existing?.Apple || []).map(m => String(m).trim().toLowerCase()));

        let added = 0, skipped = 0;
        for (const model of iphoneModels) {
          const key = model.trim().toLowerCase();
          if (existingModels.has(key)) { skipped++; continue; }
          const ok = await window.storage.addPhoneType('Apple', model);
          if (ok) { added++; existingModels.add(key); }
        }

        showResult('success', `✅ تم إكمال العملية — تمت إضافة ${added} وتخطّي ${skipped}.`);
      } catch (err) {
        console.error(err);
        showResult('danger', '❌ حدث خطأ أثناء الإضافة.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-plus-circle"></i> إضافة الأنواع الآن';
      }
    }
  </script>

</body>
</html>


